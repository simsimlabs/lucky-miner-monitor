<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ€ Lucky Miner Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // ì»¤ìŠ¤í…€ íŒŒìŠ¤í…”í†¤ ìƒ‰ìƒ ì„¤ì •
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#1a1b26', // ë” ë¶€ë“œëŸ¬ìš´ ë‚¨ìƒ‰ ë°°ê²½
                            card: '#24283b', // ì¹´ë“œ ë°°ê²½
                            text: '#a9b1d6', // ê¸°ë³¸ í…ìŠ¤íŠ¸ (ì—°í•œ íšŒìƒ‰)
                            accent: '#7aa2f7', // í¬ì¸íŠ¸ ìƒ‰ìƒ (íŒŒìŠ¤í…” ë¸”ë£¨)
                            success: '#9ece6a', // ì„±ê³µ (íŒŒìŠ¤í…” ê·¸ë¦°)
                            warning: '#e0af68', // ê²½ê³ /ê°•ì¡° (íŒŒìŠ¤í…” ì˜¤ë Œì§€)
                            error: '#f7768e'  // ì˜¤ë¥˜ (íŒŒìŠ¤í…” ë ˆë“œ)
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: theme('colors.dark.bg'); color: theme('colors.dark.text'); font-family: 'Spoqa Han Sans Neo', 'Segoe UI', sans-serif; }
        .card { background-color: theme('colors.dark.card'); border-radius: 16px; box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.2); transition: transform 0.2s; }
        /* .card:hover { transform: translateY(-2px); } */
        .pastel-gradient { background: linear-gradient(135deg, #7aa2f7 0%, #9ece6a 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body class="min-h-screen p-6 md:p-10">

    <div class="max-w-7xl mx-auto">
        
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div>
                <h1 class="text-4xl font-extrabold pastel-gradient">ğŸ€ Lucky Miner Monitor</h1>
                <p id="last-update" class="text-sm mt-2 opacity-70">ì—…ë°ì´íŠ¸ ëŒ€ê¸° ì¤‘...</p>
            </div>
            <div class="card p-2 flex gap-2 w-full md:w-auto">
                <input type="text" id="wallet-address" placeholder="ë¹„íŠ¸ì½”ì¸ ì§€ê°‘ ì£¼ì†Œ (bc1q...)" 
                       class="bg-transparent text-white px-4 py-2 rounded-lg w-full md:w-96 focus:outline-none focus:ring-2 focus:ring-dark-accent placeholder-gray-500">
                <button onclick="saveAndFetch()" class="bg-dark-accent hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-bold transition whitespace-nowrap">
                    ì¡°íšŒ ë° ì €ì¥
                </button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            
            <div class="card p-6 flex flex-col justify-between">
                <div class="flex items-center gap-3 mb-2">
                    <div class="p-2 bg-dark-accent bg-opacity-20 rounded-lg">ğŸš€</div>
                    <h3 class="text-lg font-medium">í˜„ì¬ ì†ë„ (5ë¶„ í‰ê· )</h3>
                </div>
                <div class="text-right">
                    <p id="hashrate" class="text-5xl font-mono font-extrabold text-white">0</p>
                    <span class="text-xl text-dark-accent">GH/s</span>
                </div>
            </div>

            <div class="card p-6 flex flex-col justify-between">
                <div class="flex items-center gap-3 mb-2">
                    <div class="p-2 bg-dark-warning bg-opacity-20 rounded-lg">ğŸ†</div>
                    <h3 class="text-lg font-medium">ìµœê³  ê¸°ë¡ (Best Share)</h3>
                </div>
                <div class="text-right">
                    <p id="bestshare" class="text-4xl font-mono font-extrabold text-dark-warning break-all">0</p>
                    <p class="text-sm mt-2 opacity-70">ëª©í‘œ: 100ì¡° (100,000G) ì´ìƒ</p>
                </div>
            </div>

            <div class="card p-6 grid grid-cols-2 gap-4">
                <div class="flex flex-col justify-center">
                    <span class="text-sm opacity-70">ì´ ì œì¶œ (Shares)</span>
                    <span id="total-shares" class="text-2xl font-mono font-bold text-white mt-1">-</span>
                </div>
                <div class="flex flex-col justify-center items-end text-right">
                    <span class="text-sm opacity-70">ê¸°ê¸° ìƒíƒœ</span>
                    <span id="worker-status" class="text-xl font-bold mt-1 text-gray-500">
                        <span class="inline-block w-3 h-3 rounded-full bg-gray-500 mr-2"></span>ì—°ê²° ëŒ€ê¸°
                    </span>
                </div>
            </div>
        </div>

        <div class="card p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold flex items-center gap-2">
                    <span class="text-2xl">ğŸ“ˆ</span> ì‹¤ì‹œê°„ ì†ë„ ë³€í™”
                </h3>
                <span class="text-sm opacity-70">ìµœê·¼ 10ë¶„ ë°ì´í„°</span>
            </div>
            <div class="w-full h-[400px]"> <canvas id="hashChart"></canvas>
            </div>
        </div>

    </div> <script>
        // === 1. ì°¨íŠ¸ ì´ˆê¸°í™” ë° ì„¤ì • ===
        const ctx = document.getElementById('hashChart').getContext('2d');
        // íŒŒìŠ¤í…”í†¤ ê·¸ë¼ë°ì´ì…˜ íš¨ê³¼ ìƒì„±
        let gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(122, 162, 247, 0.5)'); // íŒŒìŠ¤í…” ë¸”ë£¨ (íˆ¬ëª…ë„)
        gradient.addColorStop(1, 'rgba(122, 162, 247, 0.0)');

        const hashChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Hashrate (GH/s)',
                    data: [],
                    borderColor: '#7aa2f7', // íŒŒìŠ¤í…” ë¸”ë£¨ ì„  ìƒ‰ìƒ
                    borderWidth: 3,
                    backgroundColor: gradient, // ê·¸ë¼ë°ì´ì…˜ ë°°ê²½
                    fill: true,
                    tension: 0.4, // ë¶€ë“œëŸ¬ìš´ ê³¡ì„ 
                    pointRadius: 0, // í¬ì¸íŠ¸ ìˆ¨ê¹€ (ê¹”ë”í•˜ê²Œ)
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false, // ì»¨í…Œì´ë„ˆ í¬ê¸°ì— ë§ì¶¤
                scales: {
                    x: {
                        grid: { display: false }, // Xì¶• ê·¸ë¦¬ë“œ ìˆ¨ê¹€
                        ticks: { color: '#a9b1d6', maxTicksLimit: 6 } // Xì¶• ê¸€ììƒ‰ ë° ê°œìˆ˜ ì œí•œ
                    },
                    y: {
                        beginAtZero: false, // 0ë¶€í„° ì‹œì‘í•˜ì§€ ì•ŠìŒ (ë³€í™” ë³´ê¸° ì‰½ê²Œ)
                        grid: { color: 'rgba(169, 177, 214, 0.1)' }, // Yì¶• ê·¸ë¦¬ë“œ ì—°í•˜ê²Œ
                        ticks: { color: '#a9b1d6' }
                    }
                },
                plugins: {
                    legend: { display: false }, // ë²”ë¡€ ìˆ¨ê¹€
                    tooltip: {
                        backgroundColor: '#24283b',
                        titleColor: '#ffffff',
                        bodyColor: '#a9b1d6',
                        displayColors: false,
                        callbacks: { label: (context) => ` ${context.parsed.y} GH/s` }
                    }
                }
            }
        });

        // === 2. ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ë° í™”ë©´ ê°±ì‹  í•¨ìˆ˜ ===
        async function fetchData() {
            const address = localStorage.getItem('btc_wallet');
            // ì£¼ì†Œê°€ ì—†ìœ¼ë©´ ì•„ë¬´ê²ƒë„ ì•ˆ í•¨
            if (!address) {
                document.getElementById('last-update').innerText = "ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                return;
            }

            // ì…ë ¥ì°½ì— ì €ì¥ëœ ì£¼ì†Œ í‘œì‹œ (ìƒˆë¡œê³ ì¹¨ ì‹œ)
            if(document.getElementById('wallet-address').value === "") {
                document.getElementById('wallet-address').value = address;
            }

            const url = `https://solo.ckpool.org/users/${address}`;

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ì˜¤ë¥˜');
                const data = await response.json();

                // --- í…ìŠ¤íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸ ---
                const hashrateVal = parseFloat(data.hashrate5m.replace('G', ''));
                // ìˆ«ìê°€ ì²œ ë‹¨ìœ„ ë„˜ì–´ê°€ë©´ ì½¤ë§ˆ ì°ê¸°
                document.getElementById('hashrate').innerText = hashrateVal.toLocaleString(undefined, {maximumFractionDigits: 1});
                document.getElementById('bestshare').innerText = Math.floor(data.bestshare).toLocaleString();
                document.getElementById('total-shares').innerText = data.shares.toLocaleString();
                
                // --- ê¸°ê¸° ìƒíƒœ í‘œì‹œ ---
                const statusElem = document.getElementById('worker-status');
                if(data.workers > 0) {
                    statusElem.innerHTML = `<span class="inline-block w-3 h-3 rounded-full bg-dark-success mr-2 animate-pulse"></span>ğŸŸ¢ ì‘ë™ ì¤‘ (${data.workers}ëŒ€)`;
                    statusElem.className = "text-xl font-bold mt-1 text-dark-success";
                } else {
                    statusElem.innerHTML = `<span class="inline-block w-3 h-3 rounded-full bg-dark-error mr-2"></span>ğŸ”´ ì—°ê²° ì—†ìŒ`;
                    statusElem.className = "text-xl font-bold mt-1 text-dark-error";
                }

                // --- ì—…ë°ì´íŠ¸ ì‹œê°„ ê°±ì‹  ---
                const now = new Date();
                document.getElementById('last-update').innerText = "ë§ˆì§€ë§‰ ê°±ì‹ : " + now.toLocaleTimeString();

                // --- ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸ ---
                const maxDataPoints = 60; // ì•½ 10ë¶„ì¹˜ ë°ì´í„° (10ì´ˆ * 60ê°œ)
                if (hashChart.data.labels.length >= maxDataPoints) {
                    hashChart.data.labels.shift(); // ê°€ì¥ ì˜¤ë˜ëœ ë°ì´í„° ì‚­ì œ
                    hashChart.data.datasets[0].data.shift();
                }
                hashChart.data.labels.push(now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'}));
                hashChart.data.datasets[0].data.push(hashrateVal);
                hashChart.update('none'); // ì• ë‹ˆë©”ì´ì…˜ ì—†ì´ ë¶€ë“œëŸ½ê²Œ ì—…ë°ì´íŠ¸

            } catch (error) {
                console.error("ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
                document.getElementById('last-update').innerHTML = "<span class='text-dark-error'>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨. ì£¼ì†Œê°€ ì •í™•í•œì§€ í™•ì¸í•´ì£¼ì„¸ìš”.</span>";
                // ì£¼ì†Œê°€ í‹€ë ¸ì„ ê²½ìš° ìƒíƒœ ì´ˆê¸°í™”
                document.getElementById('worker-status').innerHTML = `<span class="inline-block w-3 h-3 rounded-full bg-gray-500 mr-2"></span>ì£¼ì†Œ í™•ì¸ í•„ìš”`;
                statusElem.className = "text-xl font-bold mt-1 text-gray-500";
            }
        }

        // === 3. ì£¼ì†Œ ì €ì¥ ë° ìˆ˜ë™ ì¡°íšŒ ë²„íŠ¼ í´ë¦­ ì‹œ ===
        function saveAndFetch() {
            const addr = document.getElementById('wallet-address').value.trim();
            if (addr) {
                // ì£¼ì†Œ ìœ íš¨ì„± ê²€ì‚¬ (ê°„ë‹¨í•˜ê²Œ ê¸¸ì´ë¡œë§Œ ì²´í¬)
                if (addr.length < 20 || !addr.startsWith('bc1')) {
                    alert("ì˜¬ë°”ë¥¸ ë¹„íŠ¸ì½”ì¸ ì£¼ì†Œ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. (bc1...ìœ¼ë¡œ ì‹œì‘)");
                    return;
                }
                localStorage.setItem('btc_wallet', addr); // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                // ê¸°ì¡´ ê·¸ë˜í”„ ë°ì´í„° ì´ˆê¸°í™” (ìƒˆ ì£¼ì†Œë¡œ ì‹œì‘í•˜ë¯€ë¡œ)
                hashChart.data.labels = [];
                hashChart.data.datasets[0].data = [];
                hashChart.update();
                fetchData(); // ë°ì´í„° ì¦‰ì‹œ ìš”ì²­
                alert("ì£¼ì†Œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.");
            } else {
                alert("ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            }
        }

        // === 4. í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰ ===
        window.onload = function() {
            // ì €ì¥ëœ ì£¼ì†Œê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ë°”ë¡œ ì‹¤í–‰
            fetchData();
            // 10ì´ˆë§ˆë‹¤ ìë™ ê°±ì‹  ì‹œì‘
            setInterval(fetchData, 10000); 
        };
    </script>
</body>
</html>
