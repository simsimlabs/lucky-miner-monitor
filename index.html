<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ€ Lucky Miner Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        page: '#1a1b26', 
                        card: '#24283b', 
                        text: '#c0caf5',
                        muted: '#565f89',
                        accent: '#7aa2f7', 
                        success: '#9ece6a', 
                        warning: '#e0af68', 
                        error: '#f7768e',   
                        input: '#16161e'
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #1a1b26; color: #c0caf5; font-family: 'Segoe UI', sans-serif; }
        .card { background-color: #24283b; border-radius: 16px; box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5); }
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .spinner { border: 4px solid rgba(255, 255, 255, 0.1); border-left-color: #7aa2f7; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-[1600px] mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-accent to-success">
                    ğŸ€ Lucky Miner Monitor
                </h1>
                <p id="system-message" class="text-sm mt-2 text-muted">ğŸŸ¢ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</p>
            </div>
            
            <div class="card p-2 flex gap-2 w-full md:w-auto bg-[#16161e] border border-[#565f89]">
                <input type="text" id="wallet-address" 
                       placeholder="ë¹„íŠ¸ì½”ì¸ ì§€ê°‘ ì£¼ì†Œ (bc1...)" 
                       class="bg-transparent text-white px-4 py-2 w-full md:w-96 focus:outline-none placeholder-opacity-50 font-mono text-sm">
                <button onclick="saveAndFetch()" id="search-btn" class="bg-accent hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-bold transition shadow-lg whitespace-nowrap min-w-[100px]">
                    ì¡°íšŒ
                </button>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="card p-6 relative overflow-hidden">
                <h3 class="text-muted text-sm font-bold mb-2 uppercase tracking-wider">Hashrate (5m)</h3>
                <div class="flex items-baseline gap-2">
                    <span id="hashrate" class="text-5xl font-mono font-bold text-white">0</span>
                    <span class="text-xl text-accent">GH/s</span>
                </div>
            </div>

            <div class="card p-6 relative overflow-hidden">
                <h3 class="text-muted text-sm font-bold mb-2 uppercase tracking-wider">Best Share</h3>
                <div class="flex items-baseline gap-2">
                    <span id="bestshare" class="text-4xl font-mono font-bold text-warning">0</span>
                </div>
                <p class="text-xs text-muted mt-2">ëª©í‘œ: 100ì¡° ì´ìƒ</p>
            </div>

            <div class="card p-6 flex flex-col justify-between">
                <div>
                    <h3 class="text-muted text-sm font-bold mb-2 uppercase tracking-wider">Status</h3>
                    <div id="worker-status" class="text-2xl font-bold text-muted flex items-center gap-3">
                        <span class="w-3 h-3 rounded-full bg-gray-600"></span> ëŒ€ê¸° ì¤‘
                    </div>
                </div>
                <div class="flex justify-between items-end mt-4 text-sm">
                    <span class="text-muted">Total Shares</span>
                    <span id="total-shares" class="font-mono text-white text-lg">-</span>
                </div>
            </div>
        </div>

        <div class="card p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-white flex items-center gap-2">
                    ğŸ“Š ì‹¤ì‹œê°„ ì°¨íŠ¸
                </h3>
            </div>
            <div class="w-full h-[450px]">
                <canvas id="hashChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        const ctx = document.getElementById('hashChart').getContext('2d');
        let gradient = ctx.createLinearGradient(0, 0, 0, 450);
        gradient.addColorStop(0, 'rgba(122, 162, 247, 0.4)');
        gradient.addColorStop(1, 'rgba(26, 27, 38, 0.0)');

        const hashChart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [{ label: 'Hashrate', data: [], borderColor: '#7aa2f7', borderWidth: 3, backgroundColor: gradient, fill: true, tension: 0.4, pointRadius: 0, pointHoverRadius: 6 }] },
            options: { responsive: true, maintainAspectRatio: false, interaction: { intersect: false, mode: 'index' }, scales: { x: { grid: { display: false }, ticks: { color: '#565f89', maxTicksLimit: 8 } }, y: { border: { display: false }, grid: { color: '#2f354b' }, ticks: { color: '#565f89' } } }, plugins: { legend: { display: false } } }
        });

        async function fetchData() {
            let address = localStorage.getItem('btc_wallet');
            const inputField = document.getElementById('wallet-address');
            
            if (!address && inputField.value) address = inputField.value.trim();
            if (!address) return;
            if (!inputField.value) inputField.value = address;

            // --- UI: ë¡œë”© ìƒíƒœ í‘œì‹œ ---
            const btn = document.getElementById('search-btn');
            const msg = document.getElementById('system-message');
            btn.innerHTML = '<div class="spinner"></div>'; // ë²„íŠ¼ì„ ìŠ¤í”¼ë„ˆë¡œ ë³€ê²½
            msg.innerText = "ğŸ”„ ë°ì´í„° ì„œë²„ì— ì—°ê²° ì¤‘...";
            msg.className = "text-sm mt-2 text-warning animate-pulse";

            // --- í•µì‹¬ ìˆ˜ì •: CORS ìš°íšŒ í”„ë¡ì‹œ ì‚¬ìš© ---
            // api.allorigins.win ì´ë¼ëŠ” ê³µê°œ í”„ë¡ì‹œë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const targetUrl = `https://solo.ckpool.org/users/${address}`;
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(targetUrl)}&timestamp=${new Date().getTime()}`;

            try {
                const response = await fetch(proxyUrl);
                
                if (!response.ok) throw new Error('ì„œë²„ ì‘ë‹µ ì—†ìŒ');
                
                const data = await response.json();

                // ë°ì´í„°ê°€ ë¹„ì–´ìˆê±°ë‚˜ ì—ëŸ¬ì¸ ê²½ìš° ì²´í¬
                if (!data || !data.hashrate5m) {
                    throw new Error('ë°ì´í„° ì—†ìŒ (ì•„ì§ ì±„êµ´ ê¸°ë¡ì´ ì—†ê±°ë‚˜ ì£¼ì†Œ ì˜¤ë¥˜)');
                }

                const hashrate = parseFloat(data.hashrate5m.replace('G', ''));
                document.getElementById('hashrate').innerText = hashrate.toLocaleString(undefined, {maximumFractionDigits: 1});
                document.getElementById('bestshare').innerText = Math.floor(data.bestshare).toLocaleString();
                document.getElementById('total-shares').innerText = data.shares.toLocaleString();

                const statusElem = document.getElementById('worker-status');
                if (data.workers > 0) {
                    statusElem.innerHTML = `<span class="w-3 h-3 rounded-full bg-success mr-2 shadow-[0_0_10px_#9ece6a]"></span> <span class="text-success">ì •ìƒ ì‘ë™ ì¤‘ (${data.workers})</span>`;
                } else {
                    statusElem.innerHTML = `<span class="w-3 h-3 rounded-full bg-error mr-2"></span> <span class="text-error">ì—°ê²° ëŠê¹€ (Offline)</span>`;
                }

                // ê·¸ë˜í”„ ê°±ì‹ 
                const now = new Date();
                const timeStr = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                if (hashChart.data.labels.length > 60) { hashChart.data.labels.shift(); hashChart.data.datasets[0].data.shift(); }
                hashChart.data.labels.push(timeStr);
                hashChart.data.datasets[0].data.push(hashrate);
                hashChart.update('none');

                // UI ë³µêµ¬
                msg.innerText = "ğŸŸ¢ ë°ì´í„° ìˆ˜ì‹  ì„±ê³µ (10ì´ˆë§ˆë‹¤ ê°±ì‹ )";
                msg.className = "text-sm mt-2 text-success";

            } catch (error) {
                console.error(error);
                msg.innerText = `ğŸ”´ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
                msg.className = "text-sm mt-2 text-error";
                
                // í˜¹ì‹œ ëª¨ë¥´ë‹ˆ ìƒíƒœì°½ì—ë„ í‘œì‹œ
                document.getElementById('worker-status').innerHTML = `<span class="text-error text-sm">ë°ì´í„° ìˆ˜ì‹  ì‹¤íŒ¨</span>`;
            } finally {
                btn.innerText = "ì¡°íšŒ"; // ë²„íŠ¼ ì›ìƒë³µêµ¬
            }
        }

        function saveAndFetch() {
            const input = document.getElementById('wallet-address');
            const addr = input.value.trim();
            if (!addr) { alert("ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
            localStorage.setItem('btc_wallet', addr);
            hashChart.data.labels = []; hashChart.data.datasets[0].data = []; hashChart.update();
            fetchData();
        }

        window.onload = function() {
            const savedAddr = localStorage.getItem('btc_wallet');
            if (savedAddr) {
                document.getElementById('wallet-address').value = savedAddr;
                fetchData();
            }
            setInterval(fetchData, 10000);
        };
    </script>
</body>
</html>
