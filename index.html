<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ€ Lucky Miner Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // íŒŒìŠ¤í…” ë‹¤í¬ í…Œë§ˆ ìƒ‰ìƒ ê°•ì œ ì§€ì •
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // ë°°ê²½: ì•„ì£¼ ì–´ë‘ìš´ ë‚¨ìƒ‰ (Tokyo Night í…Œë§ˆ ìŠ¤íƒ€ì¼)
                        page: '#1a1b26', 
                        // ì¹´ë“œ: ë°°ê²½ë³´ë‹¤ ì‚´ì§ ë°ì€ ë‚¨ìƒ‰
                        card: '#24283b', 
                        // í…ìŠ¤íŠ¸: ëˆˆì´ í¸í•œ ì—°í•œ íšŒìƒ‰/íŒŒìŠ¤í…” ë¸”ë£¨
                        text: '#c0caf5',
                        muted: '#565f89',
                        // í¬ì¸íŠ¸ ìƒ‰ìƒ (íŒŒìŠ¤í…”í†¤)
                        accent: '#7aa2f7', // ë¸”ë£¨
                        success: '#9ece6a', // ê·¸ë¦°
                        warning: '#e0af68', // ì˜¤ë Œì§€
                        error: '#f7768e',   // ë ˆë“œ
                        input: '#16161e'    // ì…ë ¥ì°½ ë°°ê²½
                    }
                }
            }
        }
    </script>
    <style>
        /* ê°•ì œ ë‹¤í¬ëª¨ë“œ ì ìš© */
        body { background-color: #1a1b26; color: #c0caf5; font-family: 'Segoe UI', sans-serif; }
        .card { background-color: #24283b; border-radius: 16px; box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5); }
        /* ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ */
        input::placeholder { color: #565f89; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-[1600px] mx-auto">
        
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-accent to-success">
                    ğŸ€ Lucky Miner Monitor
                </h1>
                <p id="last-update" class="text-sm mt-2 text-muted">ë°ì´í„° ëŒ€ê¸° ì¤‘...</p>
            </div>
            
            <div class="card p-2 flex gap-2 w-full md:w-auto bg-[#16161e] border border-[#565f89]">
                <input type="text" id="wallet-address" 
                       placeholder="ë¹„íŠ¸ì½”ì¸ ì§€ê°‘ ì£¼ì†Œ (bc1...)" 
                       class="bg-transparent text-white px-4 py-2 w-full md:w-96 focus:outline-none placeholder-opacity-50 font-mono text-sm">
                <button onclick="saveAndFetch()" class="bg-accent hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-bold transition shadow-lg shadow-blue-500/30 whitespace-nowrap">
                    ì¡°íšŒ
                </button>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            
            <div class="card p-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10 text-9xl">ğŸš€</div>
                <h3 class="text-muted text-sm font-bold mb-2 uppercase tracking-wider">Hashrate (5m)</h3>
                <div class="flex items-baseline gap-2">
                    <span id="hashrate" class="text-5xl font-mono font-bold text-white">0</span>
                    <span class="text-xl text-accent">GH/s</span>
                </div>
            </div>

            <div class="card p-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10 text-9xl">ğŸ†</div>
                <h3 class="text-muted text-sm font-bold mb-2 uppercase tracking-wider">Best Share</h3>
                <div class="flex items-baseline gap-2">
                    <span id="bestshare" class="text-4xl font-mono font-bold text-warning">0</span>
                </div>
                <p class="text-xs text-muted mt-2">ëª©í‘œ ë‚œì´ë„: 100ì¡° ì´ìƒ</p>
            </div>

            <div class="card p-6 flex flex-col justify-between">
                <div>
                    <h3 class="text-muted text-sm font-bold mb-2 uppercase tracking-wider">Status</h3>
                    <div id="worker-status" class="text-2xl font-bold text-muted flex items-center gap-3">
                        <span class="w-3 h-3 rounded-full bg-gray-600"></span> ì—°ê²° ëŒ€ê¸°
                    </div>
                </div>
                <div class="flex justify-between items-end mt-4 text-sm">
                    <span class="text-muted">Total Shares</span>
                    <span id="total-shares" class="font-mono text-white text-lg">-</span>
                </div>
            </div>
        </div>

        <div class="card p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-white flex items-center gap-2">
                    ğŸ“Š ì‹¤ì‹œê°„ í•´ì‹œë ˆì´íŠ¸
                </h3>
                <span class="text-xs text-muted px-2 py-1 bg-[#16161e] rounded">ìµœê·¼ 10ë¶„</span>
            </div>
            <div class="w-full h-[450px]">
                <canvas id="hashChart"></canvas>
            </div>
        </div>

    </div>

    <script>
        // === 1. ì°¨íŠ¸ ë””ìì¸ (íŒŒìŠ¤í…” ê·¸ë¼ë°ì´ì…˜) ===
        const ctx = document.getElementById('hashChart').getContext('2d');
        let gradient = ctx.createLinearGradient(0, 0, 0, 450);
        gradient.addColorStop(0, 'rgba(122, 162, 247, 0.4)'); // íŒŒìŠ¤í…” ë¸”ë£¨
        gradient.addColorStop(1, 'rgba(26, 27, 38, 0.0)');   // íˆ¬ëª…

        const hashChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Hashrate',
                    data: [],
                    borderColor: '#7aa2f7',
                    borderWidth: 3,
                    backgroundColor: gradient,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0,
                    pointHoverRadius: 6,
                    pointBackgroundColor: '#c0caf5'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { intersect: false, mode: 'index' },
                scales: {
                    x: {
                        grid: { display: false },
                        ticks: { color: '#565f89', maxTicksLimit: 8 }
                    },
                    y: {
                        border: { display: false },
                        grid: { color: '#2f354b' },
                        ticks: { color: '#565f89' }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: '#16161e',
                        titleColor: '#c0caf5',
                        bodyColor: '#7aa2f7',
                        borderColor: '#2f354b',
                        borderWidth: 1,
                        padding: 10,
                        displayColors: false,
                        callbacks: { label: (c) => ` ${c.parsed.y} GH/s` }
                    }
                }
            }
        });

        // === 2. í•µì‹¬ ê¸°ëŠ¥ ===
        
        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function fetchData() {
            // ì €ì¥ëœ ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸°
            let address = localStorage.getItem('btc_wallet');
            const inputField = document.getElementById('wallet-address');

            // ì €ì¥ëœ ì£¼ì†Œê°€ ì—†ìœ¼ë©´ ì…ë ¥ì°½ ê°’ì´ë¼ë„ í™•ì¸
            if (!address && inputField.value) {
                address = inputField.value.trim();
            }

            // ì£¼ì†Œê°€ ì—†ìœ¼ë©´ ì¤‘ë‹¨
            if (!address) return;

            // ì…ë ¥ì°½ì´ ë¹„ì–´ìˆìœ¼ë©´ ì±„ì›Œì£¼ê¸°
            if (!inputField.value) inputField.value = address;

            const url = `https://solo.ckpool.org/users/${address}`;

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('API ì˜¤ë¥˜');
                const data = await response.json();

                // ìˆ«ì ì—…ë°ì´íŠ¸
                const hashrate = parseFloat(data.hashrate5m.replace('G', ''));
                document.getElementById('hashrate').innerText = hashrate.toLocaleString(undefined, {maximumFractionDigits: 1});
                document.getElementById('bestshare').innerText = Math.floor(data.bestshare).toLocaleString();
                document.getElementById('total-shares').innerText = data.shares.toLocaleString();

                // ìƒíƒœ ì—…ë°ì´íŠ¸
                const statusElem = document.getElementById('worker-status');
                if (data.workers > 0) {
                    statusElem.innerHTML = `<span class="w-3 h-3 rounded-full bg-success mr-2 shadow-[0_0_10px_#9ece6a]"></span> <span class="text-success">ì‘ë™ ì¤‘ (${data.workers})</span>`;
                } else {
                    statusElem.innerHTML = `<span class="w-3 h-3 rounded-full bg-error mr-2"></span> <span class="text-error">ì—°ê²° ëŠê¹€</span>`;
                }

                // ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
                const now = new Date();
                const timeStr = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                
                if (hashChart.data.labels.length > 60) {
                    hashChart.data.labels.shift();
                    hashChart.data.datasets[0].data.shift();
                }
                hashChart.data.labels.push(timeStr);
                hashChart.data.datasets[0].data.push(hashrate);
                hashChart.update('none'); // ê¹œë¹¡ì„ ì—†ì´ ì—…ë°ì´íŠ¸

                document.getElementById('last-update').innerText = "ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: " + timeStr;

            } catch (error) {
                console.error(error);
                document.getElementById('last-update').innerText = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ì£¼ì†Œ í™•ì¸ í•„ìš”)";
            }
        }

        // ë²„íŠ¼ í´ë¦­ ì‹œ ì €ì¥ ë° ì¡°íšŒ
        function saveAndFetch() {
            const input = document.getElementById('wallet-address');
            const addr = input.value.trim();

            if (!addr) {
                alert("ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }

            // ì£¼ì†Œ ì €ì¥
            localStorage.setItem('btc_wallet', addr);
            
            // ê·¸ë˜í”„ ì´ˆê¸°í™” í›„ ì¬ì¡°íšŒ
            hashChart.data.labels = [];
            hashChart.data.datasets[0].data = [];
            hashChart.update();
            
            fetchData();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.onload = function() {
            const savedAddr = localStorage.getItem('btc_wallet');
            if (savedAddr) {
                document.getElementById('wallet-address').value = savedAddr;
                fetchData();
            }
            // 10ì´ˆë§ˆë‹¤ ìë™ ê°±ì‹ 
            setInterval(fetchData, 10000);
        };
    </script>
</body>
</html>
